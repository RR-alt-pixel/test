# ==============================
# üì¶ 1. –ë–ê–ó–û–í–´–ô –û–ë–†–ê–ó
# ==============================
FROM python:3.11-slim

# ==============================
# ‚öôÔ∏è 2. –£–°–¢–ê–ù–û–í–ö–ê –°–ò–°–¢–ï–ú–ù–´–• –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô
# ==============================
# –ö–æ–ø–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
COPY apt-packages.txt .

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è Playwright –∏ Chromium
RUN apt-get update && \
    xargs apt-get install -y --no-install-recommends -f < apt-packages.txt && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

# ==============================
# üß± 3. –£–°–¢–ê–ù–û–í–ö–ê PYTHON-–ü–ê–ö–ï–¢–û–í
# ==============================
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ==============================
# üåç 4. –£–°–¢–ê–ù–û–í–ö–ê PLAYWRIGHT + –ë–†–ê–£–ó–ï–†–û–í
# ==============================
RUN python -m playwright install --with-deps chromium

# ==============================
# üìÇ 5. –ö–û–ü–ò–†–£–ï–ú –ü–†–û–ï–ö–¢ –í –ö–û–ù–¢–ï–ô–ù–ï–†
# ==============================
WORKDIR /app
COPY . .

# ==============================
# üîë 6. –î–û–ë–ê–í–õ–Ø–ï–ú –ü–†–ê–í–ê –ù–ê start.sh
# ==============================
RUN chmod +x start.sh

# ==============================
# üöÄ 7. –ó–ê–ü–£–°–ö –ü–†–ò –°–¢–ê–†–¢–ï –ö–û–ù–¢–ï–ô–ù–ï–†–ê
# ==============================
CMD ["./start.sh"]
